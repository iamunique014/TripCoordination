@model IEnumerable<TripCoordination.Common.ViewModel.MyTripGroupedViewModel>

@{
    ViewData["Title"] = "My Trips";

    var upcomingTrips = Model
        .Where(t => t.DepartureDate >= DateTime.Now)
        .OrderBy(t => t.DepartureDate)
        .ToList();

    var pastTrips = Model
        .Where(t => t.DepartureDate < DateTime.Now)
        .OrderByDescending(t => t.DepartureDate)
        .ToList();
}

<div class="page-title p-3 label-control">
    <h3>My Trips</h3>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-container-win d-flex align-items-center alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        <div>@TempData["Success"]</div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model.Any())
{
    <!-- Tabs navigation -->
    <ul class="nav nav-tabs form-container p-3" id="tripTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab" aria-controls="upcoming" aria-selected="true">
                Upcoming Trips
                <span class="badge ms-1">@upcomingTrips.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button" role="tab" aria-controls="past" aria-selected="false">
                Past Trips
                <span class="badge ms-1">@pastTrips.Count</span>
            </button>
        </li>
    </ul>

    <!-- Tabs content -->
    <div class="tab-content mt-3 px-2" id="tripTabsContent">
        <!-- Upcoming -->
        <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
            @if (upcomingTrips.Any())
            {
                @foreach (var trip in upcomingTrips)
                {
                    @Html.Partial("_UserTripCard", trip)
                }
            }
            else
            {
                <div class="alert alert-info">You have no upcoming trips.</div>
            }
        </div>

        <!-- Past -->
        <div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab">
            @if (pastTrips.Any())
            {
                @foreach (var trip in pastTrips)
                {
                    @Html.Partial("_UserTripCard", trip)
                }
            }
            else
            {
                <div class="alert alert-light">No past trips yet.</div>
            }
        </div>
    </div>
}
else
{
    <div class="alert alert-info mt-4">
        <i class="bi bi-info-circle me-2"></i>
        You haven't joined any trip, Click search Trip to find a Trip!.
    </div>
    <div class="text-end">
        <a asp-controller="Home" asp-action="Index" class="btn btn-primary w-25">Search Trip</a>
    </div>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
}
